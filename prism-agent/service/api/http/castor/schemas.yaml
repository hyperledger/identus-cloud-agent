components:
  schemas:
    DIDResponse:
      type: object
      required:
        - did
        - metadata
      properties:
        did:
          $ref: "#/components/schemas/DIDDocumentDataModel"
        metadata:
          $ref: "#/components/schemas/DIDDocumentMetadata"

    DIDOperationResponse:
      type: object
      required:
        - scheduledOperation
      properties:
        scheduledOperation:
          $ref: "#/components/schemas/DidOperationSubmission"

    DIDResolutionResult:
      type: object
      required:
        - "@context"
        - didDocumentMetadata
        - didResolutionMetadata
      properties:
        "@context":
          type: string
          example: "https://w3id.org/did-resolution/v1"
        didDocument:
          $ref: "#/components/schemas/DIDDocument"
        didDocumentMetadata:
          $ref: "#/components/schemas/DIDDocumentMetadata"
        didResolutionMetadata:
          $ref: "#/components/schemas/DIDResolutionMetadata"

    DIDDocument:
      type: object
      description: |
        A Prism DID document data model capable of being transformed into W3C compliant representation.
      required:
        - "@context"
        - id
      properties:
        "@context":
          type: array
          items:
            type: string
            example: "https://www.w3.org/ns/did/v1"
        id:
          type: string
          description: |
            [DID subject](https://www.w3.org/TR/did-core/#did-subject).
            The value must match the DID that was given to the resolver.
          example: "did:prism:4a5b5cf0a513e83b598bbea25cd6196746747f361a73ef77068268bc9bd732ff"
        controller:
          type: string
          description: |
            [DID controller](https://www.w3.org/TR/did-core/#did-controller)
          example: "did:prism:4a5b5cf0a513e83b598bbea25cd6196746747f361a73ef77068268bc9bd732ff"
        verificationMethod:
          type: array
          items:
            $ref: "#/components/schemas/VerificationMethod"
        authentication:
          type: array
          items:
            $ref: "#/components/schemas/VerificationMethodRef"
        assertionMethod:
          type: array
          items:
            $ref: "#/components/schemas/VerificationMethodRef"
        keyAgreement:
          type: array
          items:
            $ref: "#/components/schemas/VerificationMethodRef"
        capabilityInvocation:
          type: array
          items:
            $ref: "#/components/schemas/VerificationMethodRef"
        capabilityDelegation:
          type: array
          items:
            $ref: "#/components/schemas/VerificationMethodRef"
        service:
          type: array
          items:
            $ref: "#/components/schemas/Service"

    DIDDocumentDataModel:
      type: object
      description: |
        A Prism DID document data model capable of being transformed into W3C compliant representation.
      required:
        - id
      properties:
        id:
          type: string
          description: |
            [DID subject](https://www.w3.org/TR/did-core/#did-subject).
            The value must match the DID that was given to the resolver.
          example: "did:prism:4a5b5cf0a513e83b598bbea25cd6196746747f361a73ef77068268bc9bd732ff"
        controller:
          type: string
          description: |
            [DID controller](https://www.w3.org/TR/did-core/#did-controller)
          example: "did:prism:4a5b5cf0a513e83b598bbea25cd6196746747f361a73ef77068268bc9bd732ff"
        verificationMethod:
          type: array
          items:
            $ref: "#/components/schemas/VerificationMethod"
        authentication:
          type: array
          items:
            $ref: "#/components/schemas/VerificationMethodOrRef"
        assertionMethod:
          type: array
          items:
            $ref: "#/components/schemas/VerificationMethodOrRef"
        keyAgreement:
          type: array
          items:
            $ref: "#/components/schemas/VerificationMethodOrRef"
        capabilityInvocation:
          type: array
          items:
            $ref: "#/components/schemas/VerificationMethodOrRef"
        capabilityDelegation:
          type: array
          items:
            $ref: "#/components/schemas/VerificationMethodOrRef"
        service:
          type: array
          items:
            $ref: "#/components/schemas/Service"

    DIDDocumentMetadata:
      type: object
      description: |
        [DID document metadata](https://www.w3.org/TR/did-core/#did-document-metadata)
      properties:
        deactivated:
          type: boolean
          description: If a DID has been deactivated, DID document metadata MUST include this property with the boolean value true. If a DID has not been deactivated, this property is OPTIONAL, but if included, MUST have the boolean value false.
        canonicalId:
          type: string
          description: |
            A DID in canonical form.

            If a DID is in long form and has been published, DID document metadata MUST contain a `canonicalId`` property with the short form DID as its value.

            If a DID in short form or has not been published, DID document metadata MUST NOT contain a `canonicalId` property.

    DIDResolutionMetadata:
      type: object
      description: |
        [DID resolution metadata](https://www.w3.org/TR/did-core/#did-resolution-metadata)
      properties:
        error:
          type: string
          description: Resolution error constant according to [DID spec registries](https://www.w3.org/TR/did-spec-registries/#error)
          example: invalidDid

    VerificationMethod:
      type: object
      description: |
        A cryptographic public key expressed in the DID document.
        https://www.w3.org/TR/did-core/#verification-methods
      required:
        - id
        - type
        - controller
        - publicKeyJwk
      properties:
        id:
          type: string
          example: "did:prism:4a5b5cf0a513e83b598bbea25cd6196746747f361a73ef77068268bc9bd732ff#key-1"
        type:
          type: string
          example: "EcdsaSecp256k1VerificationKey2019"
        controller:
          type: string
          example: "did:prism:4a5b5cf0a513e83b598bbea25cd6196746747f361a73ef77068268bc9bd732ff"
        publicKeyJwk:
          $ref: "#/components/schemas/PublicKeyJwk"

    VerificationMethodOrRef:
      type: object
      description: |
        An embedded verificationMethod as JSON or a referenced key as a URI.
        Referenced key and embedded key are mutually exclusive.
        If the type is EMBEDDED, `uri` field must be present.
        Otherwise `verificationMethod` field must be present.
      required:
        - type
      properties:
        type:
          type: string
          example: EMBEDDED
          enum:
            - EMBEDDED
            - REFERENCED
        uri:
          type: string
          example: did:prism:c7bd808e8e135236d7262ecf5e639b8f9d22bd886f59a4e6c909486846ca8319#key-1
        verificationMethod:
          $ref: "#/components/schemas/VerificationMethod"

    VerificationMethodRef:
      type: string
      description: |
        A reference to a `verificationMethod`
      example: did:prism:c7bd808e8e135236d7262ecf5e639b8f9d22bd886f59a4e6c909486846ca8319#key-1

    CreateManagedDidRequest:
      type: object
      required:
        - documentTemplate
      properties:
        documentTemplate:
          type: object
          required:
            - storage
            - publicKeys
            - services
          properties:
            publicKeys:
              type: array
              items:
                $ref: "#/components/schemas/ManagedDIDKeyTemplate"
            services:
              type: array
              items:
                $ref: "#/components/schemas/Service"

    CreateManagedDIDResponse:
      type: object
      required:
        - longFormDid
      properties:
        longFormDid:
          type: string
          description: A long-form DID for the created DID
          example: did:prism:4a5b5cf0a513e83b598bbea25cd6196746747f361a73ef77068268bc9bd732ff:Cr4BCrsBElsKBmF1dGgtMRAEQk8KCXNlY3AyNTZrMRIg0opTuxu-zt6aRbT1tPniG4eu4CYsQPM3rrLzvzNiNgwaIIFTnyT2N4U7qCQ78qtWC3-p0el6Hvv8qxG5uuEw-WgMElwKB21hc3RlcjAQAUJPCglzZWNwMjU2azESIKhBU0eCOO6Vinz_8vhtFSAhYYqrkEXC8PHGxkuIUev8GiAydFHLXb7c22A1Uj_PR21NZp6BCDQqNq2xd244txRgsQ

    UpdateManagedDIDRequest:
      type: object
      required:
        - actions
      properties:
        actions:
          type: array
          description: |
            A list of actions to perform on DID document.
            The field `addKey`, `removeKey`, `addService`, `removeService`, `updateService` must corresponds to
            the `actionType` specified. For example, `addKey` must be present when `actionType` is `ADD_KEY`.
          items:
            type: object
            description: Detail of DID update action. Only property matching actionType can be present.
            required:
              - actionType
            properties:
              actionType:
                type: string
                enum:
                  - ADD_KEY
                  - REMOVE_KEY
                  - ADD_SERVICE
                  - REMOVE_SERVICE
                  - UPDATE_SERVICE
                example: ADD_KEY
              addKey:
                $ref: "#/components/schemas/ManagedDIDKeyTemplate"
              removeKey:
                type: object
                required:
                  - id
                properties:
                  id:
                    type: string
                    description: ID of key to remove from DID document
                    example: key-1
              addService:
                $ref: "#/components/schemas/Service"
              removeService:
                type: object
                required:
                  - id
                properties:
                  id:
                    type: string
                    description: ID of service to remove from DID document
                    example: service-1
              updateService:
                type: object
                description: A patch to existing Service. 'type' and 'serviceEndpoint' can't both be empty.
                required:
                  - id
                properties:
                  id:
                    type: string
                    description: ID of existing service to update in the DID document
                    example: service-1
                  type:
                    type: string
                    enum:
                      - LinkedDomains
                    example: LinkedDomains
                  serviceEndpoint:
                    type: array
                    items:
                      type: string
                      example: "https://bar.example.com/"

    ManagedDIDPage:
      allOf:
        - $ref: "../shared/schemas.yaml#/components/schemas/Pagination"
        - type: object
          required: [contents]
          properties:
            contents:
              type: array
              items:
                $ref: "#/components/schemas/ManagedDID"

    ManagedDID:
      type: object
      required:
        - did
        - status
      properties:
        did:
          type: string
          example: did:prism:4a5b5cf0a513e83b598bbea25cd6196746747f361a73ef77068268bc9bd732ff
        longFormDid:
          type: string
          description: A long-form DID. Mandatory when status is not PUBLISHED and optional when status is PUBLISHED
          example: did:prism:4a5b5cf0a513e83b598bbea25cd6196746747f361a73ef77068268bc9bd732ff:Cr4BCrsBElsKBmF1dGgtMRAEQk8KCXNlY3AyNTZrMRIg0opTuxu-zt6aRbT1tPniG4eu4CYsQPM3rrLzvzNiNgwaIIFTnyT2N4U7qCQ78qtWC3-p0el6Hvv8qxG5uuEw-WgMElwKB21hc3RlcjAQAUJPCglzZWNwMjU2azESIKhBU0eCOO6Vinz_8vhtFSAhYYqrkEXC8PHGxkuIUev8GiAydFHLXb7c22A1Uj_PR21NZp6BCDQqNq2xd244txRgsQ
        status:
          type: string
          description: |
            A status indicating a publication state of a DID in the wallet (e.g. PUBLICATION_PENDING, PUBLISHED).
            Does not represent DID a full lifecyle (e.g. deactivated, recovered, updated).
          enum:
            - CREATED
            - PUBLICATION_PENDING
            - PUBLISHED

    PublicKeyJwk:
      type: object
      required:
        - kty
      properties:
        crv:
          type: string
          example: "secp256k1"
        x:
          type: string
          example: "38M1FDts7Oea7urmseiugGW7tWc3mLpJh6rKe7xINZ8"
        y:
          type: string
          example: "nDQW6XZ7b_u2Sy9slofYLlG03sOEoug3I0aAPQ0exs4"
        kty:
          type: string
          example: "EC"

    Service:
      type: object
      description: |
        A service expressed in the DID document.
        https://www.w3.org/TR/did-core/#services
      required:
        - id
        - type
        - serviceEndpoint
      properties:
        id:
          type: string
          example: "service-1"
        type:
          type: string
          description: |
            Service type.
            Can contain multiple possible values as described in the [Create DID operation](https://github.com/input-output-hk/prism-did-method-spec/blob/main/w3c-spec/PRISM-method.md#create-did) under the construction section.

            *Known issue: This is currently misaligned with Prism DID method. This will be fixed in the future version of Prism Agent*
          enum:
            - LinkedDomains
          example: LinkedDomains
        serviceEndpoint:
          type: array
          description: |
            Application service endpoints.
            Can contain multiple possible values as described in the [Create DID operation](https://github.com/input-output-hk/prism-did-method-spec/blob/main/w3c-spec/PRISM-method.md#create-did) under the construction section.

            *Known issue: This is currently misaligned with Prism DID method. This will be fixed in the future version of Prism Agent*
          items:
            type: string
            example: "https://bar.example.com/"

    ManagedDIDKeyTemplate:
      type: object
      description: key-pair template to add to DID document.
      required:
        - id
        - purpose
      properties:
        id:
          type: string
          description: Identifier of a verification material in the DID Document
          example: key-1
        purpose:
          type: string
          enum:
            [
              "authentication",
              "assertionMethod",
              "keyAgreement",
              "capabilityInvocation",
              "capabilityDelegation",
            ]
          example: "authentication"

    # ----------------------------------
    # ASYNC OPERATIONS
    # ----------------------------------
    DidOperationSubmission:
      type: object
      required:
        - id
        - didRef
      properties:
        id:
          type: string
          example: 98e6a4db10e58fcc011dd8def5ce99fd8b52af39e61e5fb436dc28259139818b
        didRef:
          type: string
          example: did:prism:4a5b5cf0a513e83b598bbea25cd6196746747f361a73ef77068268bc9bd732ff
